{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Bioelectric Subroutine",
  "description": "A standardized definition of a morphological command triggered by bioelectric state change with closed-loop homeostatic control.",
  "type": "object",
  "required": ["id", "metadata", "target_morphology", "bioelectric_state", "hardware_drivers", "developmental_context", "control_loop", "delivery_method"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this subroutine (e.g., 'xenopus_eye_induction_v1')."
    },
    "metadata": {
      "type": "object",
      "properties": {
        "author": { "type": "string" },
        "description": { "type": "string" },
        "version": { "type": "string" },
        "references": {
          "type": "array",
          "items": { "type": "string", "description": "DOI or citation for the source experiment." }
        }
      }
    },
    "developmental_context": {
      "type": "object",
      "description": "The specific timing and developmental window for the intervention.",
      "required": ["stage_start", "reference_system"],
      "properties": {
        "stage_start": { "type": "string", "description": "Start stage (e.g., 'NF Stage 10.5')." },
        "stage_end": { "type": "string", "description": "End stage (e.g., 'NF Stage 24')." },
        "reference_system": { "type": "string", "description": "Staging system used (e.g., 'Nieuwkoop and Faber')." }
      }
    },
    "target_morphology": {
      "type": "object",
      "description": "The high-level anatomical outcome.",
      "properties": {
        "organ": { "type": "string", "enum": ["eye", "limb", "head", "tail", "brain"] },
        "species": { "type": "string", "description": "Target organism (e.g., Xenopus laevis, Dugesia japonica)." },
        "action": { "type": "string", "enum": ["induce", "regenerate", "remodel", "suppress_tumor"] }
      }
    },
    "bioelectric_state": {
      "type": "object",
      "description": "The 'software' layer: the physiological state required to trigger the outcome.",
      "properties": {
        "target_vmem_range": {
          "type": "array",
          "items": { "type": "number" },
          "description": "The required membrane potential range in mV (e.g., [-20, -40])."
        },
        "spatial_domain": {
          "type": "string",
          "description": "Where this state must be applied (e.g., 'ventral_ectoderm', 'amputation_plane')."
        },
        "duration_hours": {
          "type": "number",
          "description": "How long the state must be maintained to trigger the module (e.g., 48 hours for planaria)."
        }
      }
    },
    "control_loop": {
      "type": "object",
      "description": "Closed-loop homeostatic control parameters for maintaining the bioelectric state.",
      "required": ["monitoring_frequency", "feedback_mechanism", "termination_criteria"],
      "properties": {
        "monitoring_frequency": {
          "type": "string",
          "description": "How often to measure Vmem (e.g., 'Every 4 hours', 'Every 6 hours from Stage 10.5 to Stage 24')."
        },
        "feedback_mechanism": {
          "type": "object",
          "description": "Corrective actions if the bioelectric state drifts from target.",
          "properties": {
            "if_vmem_drifts_above": {
              "type": "number",
              "description": "Upper threshold in mV that triggers corrective action."
            },
            "if_vmem_drifts_below": {
              "type": "number",
              "description": "Lower threshold in mV that triggers corrective action."
            },
            "corrective_action": {
              "type": "string",
              "description": "Intervention to restore target state (e.g., 'Apply booster dose of 0.5 ng Kv1.5')."
            }
          }
        },
        "termination_criteria": {
          "type": "object",
          "description": "Conditions that signal successful completion and when to stop the intervention.",
          "required": ["max_duration_hours"],
          "properties": {
            "anatomical_marker": {
              "type": "string",
              "description": "Observable morphological endpoint (e.g., 'Formation of optic cup at Stage 24')."
            },
            "bioelectric_marker": {
              "type": "string",
              "description": "Vmem signature indicating completion (e.g., 'Normalization to -40mV')."
            },
            "max_duration_hours": {
              "type": "number",
              "description": "Maximum intervention duration to prevent overgrowth/tumors."
            }
          }
        }
      }
    },
    "delivery_method": {
      "type": "object",
      "description": "How the hardware driver is physically delivered to achieve spatial specificity.",
      "required": ["type", "spatial_restriction"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["microinjection", "bath_application", "bead_implantation", "electroporation", "optogenetic_targeting"],
          "description": "Physical delivery mechanism."
        },
        "spatial_restriction": {
          "type": "string",
          "enum": ["local", "regional", "systemic"],
          "description": "Spatial scope of the intervention."
        },
        "timing": {
          "type": "string",
          "description": "When to deliver (e.g., '4-cell stage, ventral blastomere V1')."
        },
        "notes": {
          "type": "string",
          "description": "Additional delivery considerations."
        }
      }
    },
    "hardware_drivers": {
      "type": "array",
      "description": "The 'machine code': compatible molecular tools that can force this state.",
      "items": {
        "type": "object",
        "properties": {
          "type": { "type": "string", "enum": ["ion_channel_mRNA", "drug_cocktail", "optogenetics", "ionophore", "protein_complex", "ionophore_cocktail"] },
          "name": { "type": "string", "description": "Specific agent name (e.g., 'Kv1.5', 'H+ V-ATPase', 'Ivermectin')." },
          "mechanism_of_action": { "type": "string", "description": "e.g., 'Potassium efflux', 'Proton pumping', 'Gap junction blockade'." },
          "dosage": { "type": "string", "description": "Precise dosage information (e.g., '1-2 ng per blastomere', '127 Î¼M')." }
        }
      }
    }
  }
}
